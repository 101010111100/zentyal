#!/bin/sh -e

DATA_DIR=/tmp/zinstaller-remote

mkdir -p /target/var/lib/
cp -r $DATA_DIR /target/var/lib/

# FIXME: remove this when packages from jacalvo/new-dr are available in QA repo
exit 0

if ! [ -f $DATA_DIR/QA_USERNAME ]
then
    exit 0
fi

USERNAME=`cat $DATA_DIR/QA_USERNAME`
PASSWORD=`cat $DATA_DIR/QA_PASSWORD`
REPO=qa.cloud.zentyal.com

SOURCES_DIR=/target/etc/apt/sources.list.d
mkdir -p $SOURCES_DIR
echo "deb https://$USERNAME:$PASSWORD@$REPO/ zentyal-qa-3.0-precise main universe multiverse" >> $SOURCES_DIR/zentyal-qa.list

PREFERENCES_DIR=/target/etc/apt/preferences.d
mkdir -p $PREFERENCES_DIR
cat >> $PREFERENCES_DIR/01zentyal <<EOF
Package: *
Pin: release a=zentyal-qa
Pin-Priority: 900

Package: *
Pin: release a=now
Pin-Priority: 500

Package: *
Pin: release *
Pin-Priority: 50
EOF

exit 0
